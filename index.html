<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
</head>
<body>
    <div id="multiplayer-ui" style="background:#444; padding:10px; border-radius:10px; margin-bottom:10px;">
        <input type="text" id="room-input" placeholder="è¼¸å…¥æˆ¿é–“è™Ÿç¢¼" style="padding:5px; border-radius:5px;">
        <button onclick="connectRoom()">é€²å…¥æˆ¿é–“</button>
        <span id="status" style="font-size:0.7rem; color: #ffeb3b;">ğŸ”´ æœªé€£ç·š</span>
    </div>

    <script>
    // 1. Firebase é…ç½® (è«‹åˆ° Firebase æ§åˆ¶å°å…è²»ç”³è«‹å¾Œæ›¿æ›æ­¤è™•)
    const firebaseConfig = {
        databaseURL: "https://ä½ çš„å°ˆæ¡ˆåç¨±-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentRoom = null;

    // 2. é€£ç·šæˆ¿é–“é‚è¼¯
    function connectRoom() {
        const id = document.getElementById('room-input').value;
        if (!id) return alert("è«‹è¼¸å…¥æˆ¿é–“è™Ÿ");
        
        currentRoom = id;
        document.getElementById('status').innerText = "ğŸŸ¢ å·²é€£ç·š: " + id;

        // ç›£è½é›²ç«¯æ•¸æ“šï¼šç•¶ä»»ä½•ä¸€æ–¹ä¿®æ”¹æ•¸æ“šï¼Œé›™æ–¹éƒ½æœƒè§¸ç™¼æ­¤è™•çš„ UI æ›´æ–°
        db.ref('rooms/' + currentRoom).on('value', (snapshot) => {
            const remoteState = snapshot.val();
            if (remoteState) {
                game.state = remoteState; // æ›´æ–°æœ¬åœ°æ•¸æ“š
                game.updateUI(false);    // åƒ…æ›´æ–° UIï¼Œä¸é‡è¤‡ä¸Šå‚³
            }
        });
    }

    // 3. ä¿®æ”¹ game å°è±¡ï¼Œè®“å®ƒå…·å‚™åŒæ­¥èƒ½åŠ›
    const originalUpdateUI = game.updateUI;
    game.updateUI = function(shouldSync = true) {
        // åŸ·è¡ŒåŸå§‹ UI æ›´æ–°
        originalUpdateUI.call(game);

        // å¦‚æœéœ€è¦åŒæ­¥ä¸”å·²é€£ç·šæˆ¿é–“ï¼Œå°‡æ–°æ•¸æ“šæ¨é€åˆ°é›²ç«¯
        if (shouldSync && currentRoom) {
            db.ref('rooms/' + currentRoom).set(this.state);
        }
    };

    // 4. ä¿®æ”¹æ‰€æœ‰å‹•ä½œ (Roll, Transmute, Summon)
    // ç¢ºä¿å®ƒå€‘åœ¨å‘¼å« updateUI æ™‚æœƒè§¸ç™¼åŒæ­¥
</script>
</body>
</html>
