<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Seasons Pro - ç­–ç•¥å¤§å¸«</title>
    <style>
        :root {
            --spring: #4CAF50; --summer: #FFD700; --autumn: #FF9800; --winter: #2196F3;
            --bg: #1a1a1c; --panel: #2a2a2e;
        }
        body { font-family: 'Segoe UI', system-ui; background: var(--bg); color: white; margin: 0; padding: env(safe-area-inset-top) 10px env(safe-area-inset-bottom); overflow-x: hidden; }
        
        /* ä»‹é¢æ¡†æ¶ */
        .header { display: flex; justify-content: space-between; background: var(--panel); padding: 12px; border-radius: 12px; margin-bottom: 8px; border: 1px solid #444; }
        .res-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 10px; }
        .res-item { background: #222; padding: 8px; border-radius: 8px; text-align: center; border: 2px solid transparent; transition: 0.3s; }
        
        /* å­£ç¯€é¡¯ç¤º */
        #season-display { text-align: center; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* å¡ç‰Œå€å¡Š */
        .scroll-row { display: flex; overflow-x: auto; gap: 10px; padding: 5px; min-height: 100px; }
        .card { 
            min-width: 130px; background: #eee; color: #333; padding: 10px; border-radius: 10px; 
            font-size: 0.8rem; position: relative; flex-shrink: 0; animation: fadeIn 0.4s;
        }
        .card.passive { border: 3px solid #9c27b0; } /* è¢«å‹•æŠ€èƒ½å¡æ¨™è¨˜ */
        .card-img { font-size: 2rem; text-align: center; margin-bottom: 5px; }
        
        /* è¦†è“‹å±¤ (è¼ªæŠ½éšæ®µ) */
        #draft-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); 
            z-index: 100; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column;
        }
        .draft-slots { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .slot { background: var(--panel); padding: 10px; border-radius: 8px; text-align: center; font-size: 0.8rem; min-height: 60px; border: 1px dashed #666; }
        
        /* æŒ‰éˆ•é¢¨æ ¼ */
        .btn { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; background: #444; color: white; }
        .btn-main { background: linear-gradient(135deg, #e91e63, #9c27b0); }
        .btn-sm { padding: 5px 10px; font-size: 0.7rem; margin-top: 5px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="draft-overlay">
        <h2>ğŸ”® å‘½é‹åˆ†é…</h2>
        <p>å°‡ 9 å¼µå’’èªç‰Œåˆ†é…è‡³æœªä¾†ä¸‰å¹´ï¼š</p>
        <div class="draft-slots">
            <div class="slot" id="slot-1">ç¬¬ 1 å¹´<br>(å·²é¸: 0)</div>
            <div class="slot" id="slot-2">ç¬¬ 2 å¹´<br>(å·²é¸: 0)</div>
            <div class="slot" id="slot-3">ç¬¬ 3 å¹´<br>(å·²é¸: 0)</div>
        </div>
        <div class="scroll-row" id="draft-pool"></div>
        <button class="btn btn-main" style="margin-top:20px;" onclick="startMainGame()">é€²å…¥æ¯”è³½</button>
    </div>

    <div id="main-ui" style="display:none;">
        <div class="header">
            <div>ğŸ’ <span id="crystal">0</span></div>
            <div style="text-align: right;">
                <div id="year-display">ç¬¬ 1 / 3 å¹´</div>
                <div id="summon-limit">å¬å–š: 0/1</div>
            </div>
        </div>

        <div class="res-grid">
            <div class="res-item" id="res-water" onclick="actionTransmute('water')">ğŸ’§ <span id="water">0</span></div>
            <div class="res-item" id="res-fire" onclick="actionTransmute('fire')">ğŸ”¥ <span id="fire">0</span></div>
            <div class="res-item" id="res-wind" onclick="actionTransmute('wind')">ğŸƒ <span id="wind">0</span></div>
            <div class="res-item" id="res-earth" onclick="actionTransmute('earth')">ğŸª¨ <span id="earth">0</span></div>
        </div>

        <div id="season-display">æ˜¥å­£</div>

        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:10px; margin-bottom:15px;">
            <button class="btn btn-main" onclick="actionRoll()">ğŸ² æ“²éª°ä¸¦å‰é€²</button>
            <button class="btn" onclick="saveGame()">ğŸ’¾ å„²å­˜</button>
        </div>

        <div style="color:#aaa; font-size:0.8rem; margin:5px;">ç•¶å‰æ‰‹ç‰Œ (ç¬¬ <span id="hand-year">1</span> å¹´)</div>
        <div class="scroll-row" id="hand-area"></div>

        <div style="color:#aaa; font-size:0.8rem; margin:5px;">å·²å¬å–š (å ´ä¸Š)</div>
        <div class="scroll-row" id="field-area"></div>
    </div>

<script>
    // --- æ“´å±•å¡ç‰Œè³‡æ–™ (å¢åŠ  Trigger å±¬æ€§) ---
    const cardLibrary = [
        { id: 1, name: "æ°´ç²¾éˆ", icon: "ğŸ§œâ€â™€ï¸", cost: {water:1}, vp: 6, trigger: 'instant', effect: () => player.crystals += 5 },
        { id: 2, name: "ç«ä¹‹ç†”çˆ", icon: "âš’ï¸", cost: {fire:2}, vp: 10, trigger: 'onTransmute', effect: () => player.crystals += 2 },
        { id: 3, name: "å¤§åœ°å·¨äºº", icon: "ğŸª¨", cost: {earth:2}, vp: 15, trigger: 'instant', effect: () => player.summonMax += 1 },
        { id: 4, name: "æ™‚å…‰ç¥åƒ•", icon: "â³", cost: {wind:1, water:1}, vp: 12, trigger: 'onYearStart', effect: () => player.crystals += 10 },
        { id: 5, name: "é¢¨æš´æ ¸å¿ƒ", icon: "ğŸŒªï¸", cost: {wind:2}, vp: 8, trigger: 'onTransmute', effect: () => player.wind += 1 }
    ];

    let player = {
        year: 1, month: 0, crystals: 0,
        water: 0, fire: 0, earth: 0, wind: 0,
        summonMax: 1, currentSummon: 0,
        hand: { y1: [], y2: [], y3: [] },
        field: [],
        isDrafting: true
    };

    const seasons = [
        { name: 'æ˜¥å­£', color: 'var(--spring)', rate: {water:3, wind:2, fire:1, earth:1} },
        { name: 'å¤å­£', color: 'var(--summer)', rate: {fire:3, earth:2, water:1, wind:1} },
        { name: 'ç§‹å­£', color: 'var(--autumn)', rate: {wind:3, fire:2, water:1, earth:1} },
        { name: 'å†¬å­£', color: 'var(--winter)', rate: {earth:3, water:2, fire:1, wind:1} }
    ];

    // --- è¼ªæŠ½éšæ®µé‚è¼¯ ---
    function initDraft() {
        const pool = document.getElementById('draft-pool');
        // éš¨æ©ŸæŠ½ 9 å¼µç‰Œï¼ˆæ­¤è™•ç‚ºç¯„ä¾‹ç°¡åŒ–ï¼‰
        for(let i=0; i<9; i++) {
            const card = {...cardLibrary[Math.floor(Math.random()*cardLibrary.length)], tempId: i};
            pool.innerHTML += `<div class="card" onclick="assignCard(${card.id}, this)">
                <div class="card-img">${card.icon}</div>
                <b>${card.name}</b><br>é»æ“Šåˆ†é…
            </div>`;
        }
    }

    function assignCard(id, el) {
        const card = cardLibrary.find(c => c.id === id);
        if (player.hand.y1.length < 3) player.hand.y1.push(card);
        else if (player.hand.y2.length < 3) player.hand.y2.push(card);
        else if (player.hand.y3.length < 3) player.hand.y3.push(card);
        else return alert("å…¨éƒ¨åˆ†é…å®Œäº†ï¼");
        
        el.style.display = 'none';
        updateDraftSlots();
    }

    function updateDraftSlots() {
        document.getElementById('slot-1').innerHTML = `ç¬¬ 1 å¹´<br>(å·²é¸: ${player.hand.y1.length})`;
        document.getElementById('slot-2').innerHTML = `ç¬¬ 2 å¹´<br>(å·²é¸: ${player.hand.y2.length})`;
        document.getElementById('slot-3').innerHTML = `ç¬¬ 3 å¹´<br>(å·²é¸: ${player.hand.y3.length})`;
    }

    function startMainGame() {
        if (player.hand.y1.length + player.hand.y2.length + player.hand.y3.length < 9) {
            return alert("è«‹å…ˆåˆ†é…å®Œ 9 å¼µç‰Œï¼");
        }
        player.isDrafting = false;
        document.getElementById('draft-overlay').style.display = 'none';
        document.getElementById('main-ui').style.display = 'block';
        updateUI();
    }

    // --- éŠæˆ²æ ¸å¿ƒé‚è¼¯ ---
    function triggerEffect(triggerName) {
        player.field.forEach(card => {
            if (card.trigger === triggerName) card.effect();
        });
    }

    function actionTransmute(type) {
        const sIdx = Math.floor(player.month / 3);
        const rate = seasons[sIdx].rate[type];
        if (player[type] > 0) {
            player[type]--;
            player.crystals += rate;
            triggerEffect('onTransmute'); // è§¸ç™¼è¢«å‹•
            updateUI();
        }
    }

    function actionRoll() {
        // ç°¡åŒ–æ“²éª°ï¼šéš¨æ©Ÿçµ¦è³‡æº
        const res = ['water', 'fire', 'wind', 'earth'];
        player[res[Math.floor(Math.random()*4)]] += 1;
        player.crystals += 1;

        player.month++;
        if (player.month >= 12) {
            player.month = 0;
            player.year++;
            triggerEffect('onYearStart');
            if (player.year > 3) alert("éŠæˆ²çµæŸï¼æœ€çµ‚æ°´æ™¶: " + player.crystals);
        }
        updateUI();
        autoSave();
    }

    function actionSummon(cardId, index) {
        const currentHand = player.hand['y'+player.year];
        const card = currentHand[index];

        if (player.currentSummon >= player.summonMax) return alert("å¬å–šä¸Šé™ä¸è¶³ï¼");
        // æª¢æŸ¥è²»ç”¨ (ç•¥ï¼Œé‚è¼¯åŒå‰)
        
        player.field.push(card);
        currentHand.splice(index, 1);
        player.currentSummon++;
        if(card.trigger === 'instant') card.effect();
        
        updateUI();
    }

    // --- UI æ¸²æŸ“ ---
    function updateUI() {
        const sIdx = Math.floor(player.month / 3);
        const s = seasons[sIdx];
        
        document.getElementById('season-display').innerText = `${s.name} (åŒ¯ç‡æœ€é«˜: ${Object.keys(s.rate).reduce((a, b) => s.rate[a] > s.rate[b] ? a : b)})`;
        document.getElementById('season-display').style.backgroundColor = s.color;
        document.getElementById('year-display').innerText = `ç¬¬ ${player.year} / 3 å¹´`;
        document.getElementById('crystal').innerText = player.crystals;
        document.getElementById('summon-limit').innerText = `å¬å–š: ${player.currentSummon}/${player.summonMax}`;
        document.getElementById('hand-year').innerText = player.year;

        ['water', 'fire', 'wind', 'earth'].forEach(t => {
            document.getElementById(t).innerText = player[t];
            document.getElementById('res-'+t).style.borderColor = s.rate[t] >= 3 ? 'white' : 'transparent';
        });

        renderLists();
    }

    function renderLists() {
        const handArea = document.getElementById('hand-area');
        const currentHand = player.hand['y'+player.year] || [];
        handArea.innerHTML = currentHand.map((c, i) => `
            <div class="card ${c.trigger !== 'instant' ? 'passive' : ''}">
                <div class="card-img">${c.icon}</div>
                <b>${c.name}</b><br>
                <button class="btn btn-sm btn-main" onclick="actionSummon(${c.id}, ${i})">å¬å–š</button>
            </div>
        `).join('');

        const fieldArea = document.getElementById('field-area');
        fieldArea.innerHTML = player.field.map(c => `
            <div class="card on-field ${c.trigger !== 'instant' ? 'passive' : ''}">
                <div class="card-img">${c.icon}</div>
                <b>${c.name}</b>
            </div>
        `).join('');
    }

    // --- å„²å­˜æ©Ÿåˆ¶ ---
    function saveGame() {
        localStorage.setItem('seasons_pro_save', JSON.stringify(player));
        alert("å­˜æª”æˆåŠŸï¼");
    }

    function autoSave() {
        localStorage.setItem('seasons_pro_save', JSON.stringify(player));
    }

    function loadGame() {
        const saved = localStorage.getItem('seasons_pro_save');
        if (saved) {
            player = JSON.parse(saved);
            if (!player.isDrafting) {
                document.getElementById('draft-overlay').style.display = 'none';
                document.getElementById('main-ui').style.display = 'block';
            }
            updateUI();
        }
    }

    window.onload = () => {
        initDraft();
        loadGame();
    };
</script>
</body>
</html>
