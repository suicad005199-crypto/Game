<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seasons - å‚³å¥‡æ³•å¸«</title>
    <style>
        :root {
            --spring: #4CAF50; --summer: #FFD700; --autumn: #FF9800; --winter: #2196F3;
            --bg: #121212; --card-bg: #e0e0e0;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; user-select: none; }
        
        /* å‹•ç•«å®šç¾© */
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-pop { animation: pop 0.3s ease; }

        /* é ‚éƒ¨è³‡è¨Š */
        .header { display: flex; justify-content: space-between; align-items: center; background: #333; padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #444; }
        .res-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; font-size: 0.8rem; }
        .res-item { background: #222; padding: 5px; border-radius: 5px; text-align: center; border: 1px solid #555; }

        /* å­£ç¯€èˆ‡é€²åº¦ */
        #season-display { 
            text-align: center; padding: 20px; border-radius: 15px; font-weight: bold; font-size: 1.4rem; 
            margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); transition: 0.8s;
        }

        /* å‹•ä½œæŒ‰éˆ• */
        .actions { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 20px; }
        button { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .btn-roll { background: linear-gradient(135deg, #e91e63, #9c27b0); color: white; }
        .btn-transmute { background: #607d8b; color: white; font-size: 0.8rem; }

        /* å¡ç‰Œèˆ‡å ´ä¸Šå€ */
        .section-title { font-size: 0.9rem; margin: 10px 0 5px 5px; color: #aaa; border-left: 3px solid #e91e63; padding-left: 8px; }
        .scroll-row { display: flex; overflow-x: auto; gap: 12px; padding: 5px; }
        
        .card { 
            min-width: 140px; height: 180px; background: var(--card-bg); color: #333; 
            padding: 10px; border-radius: 12px; position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); animation: slideIn 0.4s ease;
        }
        .card.on-field { background: #fffde7; border: 2px solid #ffd54f; }
        .card-img { width: 100%; height: 60px; background: #bbb; border-radius: 5px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        
        /* çµç®—ç•«é¢ */
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div class="header">
        <div>ğŸ’ <span id="crystal" style="color: #4fc3f7; font-size: 1.2rem;">0</span></div>
        <div style="text-align: right;">
            <div id="year-display">ç¬¬ 1 / 3 å¹´</div>
            <div id="summon-limit">å¬å–š: 0/1</div>
        </div>
    </div>

    <div class="res-grid">
        <div class="res-item" onclick="transmute('water')">ğŸ’§ <span id="water">0</span></div>
        <div class="res-item" onclick="transmute('fire')">ğŸ”¥ <span id="fire">0</span></div>
        <div class="res-item" onclick="transmute('wind')">ğŸƒ <span id="wind">0</span></div>
        <div class="res-item" onclick="transmute('earth')">ğŸª¨ <span id="earth">0</span></div>
    </div>
    <div style="font-size: 0.7rem; text-align: center; color: #777; margin-top: 3px;">(é»æ“Šå…ƒç´ é€²è¡Œå­£ç¯€è½‰åŒ–)</div>

    <div id="season-display">æ˜¥å­£ (1æœˆ)</div>

    <div class="actions">
        <button class="btn-roll" onclick="rollDice()">ğŸ² æ“²éª°å­ä¸¦å‰é€²</button>
        <button class="btn-transmute" onclick="alert('é»æ“Šä¸Šæ–¹å…ƒç´ ç¬¦è™Ÿå³å¯å…Œæ›æ°´æ™¶')">âš–ï¸ è½‰åŒ–èªªæ˜</button>
    </div>

    <div class="section-title">å·²å¬å–š (å ´ä¸Š)</div>
    <div class="scroll-row" id="field-area"></div>

    <div class="section-title">å¯å¬å–šå¡ç‰Œ</div>
    <div class="scroll-row" id="card-market"></div>

    <div id="overlay">
        <h1>ç«¶è³½çµæŸ</h1>
        <p id="final-score">æœ€çµ‚æ°´æ™¶: 0</p>
        <button onclick="location.reload()" style="background: #e91e63; color: white;">é‡æ–°é–‹å§‹</button>
    </div>

<script>
    // --- æ•¸æ“šå®šç¾© ---
    const seasons = [
        { name: 'æ˜¥å­£', color: 'var(--spring)', rate: {water:2, wind:2, fire:1, earth:1}, dice: [{w:1, c:1}, {wi:1, s:1}, {c:4}] },
        { name: 'å¤å­£', color: 'var(--summer)', rate: {fire:3, earth:2, water:1, wind:1}, dice: [{f:1, c:2}, {e:1, s:1}, {c:6}] },
        { name: 'ç§‹å­£', color: 'var(--autumn)', rate: {wind:3, fire:2, water:1, earth:1}, dice: [{wi:1, c:3}, {f:1, s:1}, {c:5}] },
        { name: 'å†¬å­£', color: 'var(--winter)', rate: {earth:3, water:2, fire:1, wind:1}, dice: [{e:1, c:4}, {w:1, s:1}, {c:4}] }
    ];

    const cardLibrary = [
        { id: 1, name: "æ°´ç²¾éˆ", icon: "ğŸ§œâ€â™€ï¸", cost: {water:1}, vp: 6, effect: () => player.crystals += 5 },
        { id: 2, name: "ç«ä¹‹å„€å¼", icon: "ğŸŒ‹", cost: {fire:2}, vp: 12, effect: () => player.summonMax += 1 },
        { id: 3, name: "å¤§åœ°ä¹‹å¿ƒ", icon: "ğŸ’", cost: {earth:1, water:1}, vp: 20, effect: () => {} },
        { id: 4, name: "é¢¨æš´ç¥åƒ•", icon: "ğŸ¦…", cost: {wind:2}, vp: 15, effect: () => player.crystals += 10 }
    ];

    // --- ç©å®¶ç‹€æ…‹ ---
    let player = {
        year: 1, month: 0, crystals: 0,
        water: 0, fire: 0, earth: 0, wind: 0,
        summonMax: 1, currentSummon: 0, field: []
    };

    // --- æ ¸å¿ƒé‚è¼¯ ---
    function updateUI() {
        const sIdx = Math.floor(player.month / 3);
        const s = seasons[sIdx];
        
        const sd = document.getElementById('season-display');
        sd.innerText = `${s.name} (${player.month + 1}æœˆ)`;
        sd.style.backgroundColor = s.color;

        document.getElementById('year-display').innerText = `ç¬¬ ${player.year} / 3 å¹´`;
        document.getElementById('crystal').innerText = player.crystals;
        document.getElementById('summon-limit').innerText = `å¬å–š: ${player.currentSummon}/${player.summonMax}`;
        
        ['water', 'fire', 'wind', 'earth'].forEach(type => {
            const el = document.getElementById(type);
            el.innerText = player[type];
            el.parentElement.style.borderColor = s.rate[type] >= 3 ? '#fff' : '#555'; // é«˜åŒ¯ç‡äº®èµ·
        });
    }

    function rollDice() {
        const sIdx = Math.floor(player.month / 3);
        const dice = seasons[sIdx].dice;
        const res = dice[Math.floor(Math.random() * dice.length)];

        // ç²å¾—è³‡æºä¸¦åŠ é»è¦–è¦ºç‰¹æ•ˆ
        if(res.w) player.water += res.w;
        if(res.f) player.fire += res.f;
        if(res.wi) player.wind += res.wi;
        if(res.e) player.earth += res.e;
        if(res.c) player.crystals += res.c;
        if(res.s) player.summonMax += res.s;

        document.querySelector('.header').classList.add('animate-pop');
        setTimeout(() => document.querySelector('.header').classList.remove('animate-pop'), 300);

        // æ™‚é–“æ¨é€²
        player.month++;
        if (player.month >= 12) {
            player.month = 0;
            player.year++;
            if (player.year > 3) return endGame();
        }
        updateUI();
    }

    function transmute(type) {
        const sIdx = Math.floor(player.month / 3);
        const rate = seasons[sIdx].rate[type];
        if (player[type] > 0) {
            player[type]--;
            player.crystals += rate;
            updateUI();
        }
    }

    function summon(id) {
        const card = cardLibrary.find(c => c.id === id);
        if (player.currentSummon >= player.summonMax) return alert("å¬å–šä½ä¸è¶³ï¼");
        for (let r in card.cost) {
            if (player[r] < card.cost[r]) return alert("è³‡æºä¸è¶³ï¼");
        }

        // æ‰£è²»
        for (let r in card.cost) player[r] -= card.cost[r];
        player.currentSummon++;
        player.field.push(card);
        card.effect();
        
        renderField();
        updateUI();
    }

    function renderField() {
        const area = document.getElementById('field-area');
        area.innerHTML = player.field.map(card => `
            <div class="card on-field">
                <div class="card-img">${card.icon}</div>
                <b>${card.name}</b>
                <div style="font-size:0.7rem; margin-top:5px;">å·²åœ¨å ´ä¸Š</div>
            </div>
        `).join('');
    }

    function initMarket() {
        const market = document.getElementById('card-market');
        market.innerHTML = cardLibrary.map(card => `
            <div class="card">
                <div class="card-img">${card.icon}</div>
                <b>${card.name}</b>
                <span style="font-size:0.7rem; color:#666;">åƒ¹å€¼: ${card.vp} VP</span>
                <button onclick="summon(${card.id})" style="background:#2ecc71; color:white; font-size:0.7rem;">å¬å–š</button>
            </div>
        `).join('');
    }

    function endGame() {
        let totalVP = player.crystals;
        player.field.forEach(c => totalVP += c.vp);
        document.getElementById('final-score').innerText = `æœ€çµ‚å‹åˆ† (æ°´æ™¶+å¡ç‰Œ): ${totalVP}`;
        document.getElementById('overlay').style.display = 'flex';
    }

    initMarket();
    updateUI();
</script>
</body>
</html>
